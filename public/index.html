<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TikTok Pro Ultra</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div id="app">
    <!-- Splash -->
    <div class="splash" v-if="loading">
      <div class="splash-content">
        <i class="fab fa-tiktok"></i>
        <div class="loading-bar"></div>
      </div>
    </div>

    <!-- Auth -->
    <div class="auth-screen" v-else-if="!isAuthenticated">
      <div class="auth-box">
        <div class="auth-logo">
          <i class="fab fa-tiktok"></i>
          <h1>TikTok Pro</h1>
        </div>
        
        <div class="auth-tabs">
          <button :class="{ active: authMode === 'login' }" @click="authMode = 'login'">Ø¯Ø®ÙˆÙ„</button>
          <button :class="{ active: authMode === 'register' }" @click="authMode = 'register'">ØªØ³Ø¬ÙŠÙ„</button>
        </div>

        <!-- Login -->
        <div v-if="authMode === 'login'" class="auth-form">
          <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" v-model="loginForm.username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
          </div>
          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" v-model="loginForm.password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" @keyup.enter="handleLogin">
          </div>
          <button class="btn-primary" @click="handleLogin" :disabled="loggingIn">
            <span v-if="!loggingIn">Ø¯Ø®ÙˆÙ„</span>
            <i class="fas fa-spinner fa-spin" v-else></i>
          </button>
        </div>

        <!-- Register -->
        <div v-else class="auth-form">
          <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" v-model="registerForm.username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
          </div>
          <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" v-model="registerForm.email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
          </div>
          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" v-model="registerForm.password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" @keyup.enter="handleRegister">
          </div>
          <button class="btn-primary" @click="handleRegister" :disabled="registering">
            <span v-if="!registering">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</span>
            <i class="fas fa-spinner fa-spin" v-else></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Main App -->
    <template v-else>
      <!-- Goal Banner -->
      <div class="goal-banner" v-if="!currentUser.canGoLive">
        <div class="progress" :style="{ width: (currentUser.followers / 300 * 100) + '%' }"></div>
        <span>{{ currentUser.followers }}/300 Ù…ØªØ§Ø¨Ø¹ Ù„Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</span>
      </div>

      <!-- Live Available -->
      <div class="live-available" v-if="currentUser.canGoLive && !currentUser.isLive" @click="openLiveModal">
        <i class="fas fa-broadcast-tower"></i>
        <span>Ø§Ù„Ø¨Ø« Ù…ØªØ§Ø­!</span>
      </div>

      <!-- Header -->
      <header class="app-header">
        <div class="logo" @click="navigate('feed')">
          <i class="fab fa-tiktok"></i>
        </div>
        
        <nav class="main-nav">
          <button v-for="item in navItems" :key="item.id" :class="{ active: currentPage === item.id }" @click="navigate(item.id)">
            <i :class="item.icon"></i>
            <span>{{ item.name }}</span>
          </button>
        </nav>

        <div class="header-actions">
          <button class="btn-icon" @click="showStories = true">
            <i class="fas fa-circle-notch"></i>
            <span class="badge" v-if="unseenStories">{{ unseenStories }}</span>
          </button>
          <button class="btn-icon" @click="showChats = true">
            <i class="fas fa-comment-dots"></i>
            <span class="badge" v-if="unreadChats">{{ unreadChats }}</span>
          </button>
          <button class="btn-icon" @click="showNotifications = true">
            <i class="fas fa-bell"></i>
            <span class="badge" v-if="unreadNotifications">{{ unreadNotifications }}</span>
          </button>
          <button class="btn-icon" @click="showUpload = true">
            <i class="fas fa-plus"></i>
          </button>
          <img :src="currentUser.avatar" class="avatar-mini" @click="navigate('profile')">
        </div>
      </header>

      <!-- Content -->
      <main class="main-content">
        <!-- Feed -->
        <div v-if="currentPage === 'feed'" class="page-feed">
          <!-- Stories Bar -->
          <div class="stories-bar">
            <div class="story-item mine" @click="addStory">
              <div class="story-avatar">
                <img :src="currentUser.avatar">
                <div class="add-btn">+</div>
              </div>
              <span>Ù‚ØµØªÙŠ</span>
            </div>
            <div 
              v-for="story in storiesFeed" 
              :key="story.user.id"
              class="story-item"
              :class="{ unseen: story.hasUnseen }"
              @click="viewStory(story)"
            >
              <div class="story-avatar">
                <img :src="story.user.avatar">
                <div class="live-dot" v-if="story.user.isLive"></div>
              </div>
              <span>@{{ story.user.username }}</span>
            </div>
          </div>

          <!-- Videos -->
          <div class="video-feed">
            <div v-for="video in feedVideos" :key="video.id" class="video-card">
              <div class="video-player" @click="togglePlay(video)">
                <video :src="video.url" loop playsinline></video>
                <div class="play-btn" v-if="!video.playing"><i class="fas fa-play"></i></div>
                
                <!-- Side Actions -->
                <div class="side-actions">
                  <button @click.stop="likeVideo(video)" :class="{ active: video.isLiked }">
                    <i class="fas fa-heart"></i>
                    <span>{{ formatNumber(video.likes) }}</span>
                  </button>
                  <button @click.stop="openComments(video)">
                    <i class="fas fa-comment-dots"></i>
                    <span>{{ formatNumber(video.comments) }}</span>
                  </button>
                  <button @click.stop="saveVideo(video)" :class="{ active: video.isSaved }">
                    <i class="fas fa-bookmark"></i>
                  </button>
                  <button @click.stop="shareVideo(video)">
                    <i class="fas fa-share"></i>
                  </button>
                  <button @click.stop="goToProfile(video.user.id)">
                    <img :src="video.user.avatar">
                  </button>
                </div>

                <!-- Video Info -->
                <div class="video-info">
                  <div class="author" @click.stop="goToProfile(video.user.id)">
                    <span>@{{ video.user.username }}</span>
                    <i class="fas fa-check-circle verified" v-if="video.user.isVerified"></i>
                  </div>
                  <p>{{ video.description }}</p>
                  <div class="sound">
                    <i class="fas fa-music"></i>
                    <span>{{ video.sound }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Discover -->
        <div v-if="currentPage === 'discover'" class="page-discover">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" v-model="searchQuery" placeholder="Ø¨Ø­Ø«..." @keyup.enter="performSearch">
          </div>

          <!-- Challenges -->
          <div class="challenges-section">
            <h3><i class="fas fa-fire"></i> Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h3>
            <div class="challenges-list">
              <div 
                v-for="challenge in challenges" 
                :key="challenge.id"
                class="challenge-card"
                @click="openChallenge(challenge)"
              >
                <div class="challenge-icon">{{ challenge.thumbnail }}</div>
                <div class="challenge-info">
                  <h4>{{ challenge.title }}</h4>
                  <p>{{ challenge.participants }} Ù…Ø´Ø§Ø±Ùƒ</p>
                  <span class="prize">ğŸ’ {{ challenge.prize }}</span>
                </div>
                <button>Ø§Ù†Ø¶Ù…Ø§Ù…</button>
              </div>
            </div>
          </div>

          <!-- Suggested -->
          <div class="suggested-section">
            <h3>Ù…Ù‚ØªØ±Ø­ Ù„Ùƒ</h3>
            <div class="creators-grid">
              <div v-for="user in suggestedUsers" :key="user.id" class="creator-card" @click="goToProfile(user.id)">
                <img :src="user.avatar">
                <h4>@{{ user.username }}</h4>
                <p>{{ formatNumber(user.followers) }} Ù…ØªØ§Ø¨Ø¹</p>
                <button @click.stop="followUser(user)">+</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Leaderboard -->
        <div v-if="currentPage === 'leaderboard'" class="page-leaderboard">
          <h2>ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
          <div class="podium">
            <div class="place second" v-if="leaderboard[1]">
              <img :src="leaderboard[1].avatar">
              <span class="crown">ğŸ¥ˆ</span>
              <h4>@{{ leaderboard[1].username }}</h4>
              <p>{{ formatNumber(leaderboard[1].followers) }}</p>
            </div>
            <div class="place first" v-if="leaderboard[0]">
              <img :src="leaderboard[0].avatar">
              <span class="crown">ğŸ‘‘</span>
              <h4>@{{ leaderboard[0].username }}</h4>
              <p>{{ formatNumber(leaderboard[0].followers) }}</p>
            </div>
            <div class="place third" v-if="leaderboard[2]">
              <img :src="leaderboard[2].avatar">
              <span class="crown">ğŸ¥‰</span>
              <h4>@{{ leaderboard[2].username }}</h4>
              <p>{{ formatNumber(leaderboard[2].followers) }}</p>
            </div>
          </div>
          <div class="leader-list">
            <div v-for="(user, i) in leaderboard.slice(3)" :key="user.id" class="leader-item">
              <span class="rank">{{ i + 4 }}</span>
              <img :src="user.avatar">
              <div class="info">
                <h4>@{{ user.username }}</h4>
                <span>{{ formatNumber(user.followers) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile -->
        <div v-if="currentPage === 'profile'" class="page-profile">
          <div v-if="viewingProfile" class="profile-container">
            <div class="profile-header">
              <div class="avatar-large">
                <img :src="viewingProfile.avatar">
                <div class="live-badge" v-if="viewingProfile.isLive" @click="joinLive(viewingProfile)">
                  ğŸ”´ LIVE
                </div>
              </div>
              <h2>@{{ viewingProfile.username }}</h2>
              <p class="bio">{{ viewingProfile.bio || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ' }}</p>
              
              <div class="stats">
                <div>
                  <strong>{{ formatNumber(viewingProfile.following) }}</strong>
                  <span>ÙŠØªØ§Ø¨Ø¹</span>
                </div>
                <div>
                  <strong>{{ formatNumber(viewingProfile.followers) }}</strong>
                  <span>Ù…ØªØ§Ø¨Ø¹ÙŠÙ†</span>
                </div>
                <div>
                  <strong>{{ formatNumber(viewingProfile.likesCount) }}</strong>
                  <span>Ø¥Ø¹Ø¬Ø§Ø¨</span>
                </div>
              </div>

              <div class="actions" v-if="viewingProfile.id !== currentUser.id">
                <button :class="{ following: viewingProfile.isFollowing }" @click="followUser(viewingProfile)">
                  {{ viewingProfile.isFollowing ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©' : 'Ù…ØªØ§Ø¨Ø¹Ø©' }}
                </button>
                <button @click="startChat(viewingProfile)">Ø±Ø³Ø§Ù„Ø©</button>
                <button @click="blockUser(viewingProfile)">Ø­Ø¸Ø±</button>
              </div>
              <div class="actions" v-else>
                <button @click="showEditProfile = true">ØªØ¹Ø¯ÙŠÙ„</button>
              </div>
            </div>

            <div class="profile-tabs">
              <button :class="{ active: profileTab === 'videos' }" @click="profileTab = 'videos'">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</button>
              <button :class="{ active: profileTab === 'saved' }" @click="profileTab = 'saved'">Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</button>
              <button :class="{ active: profileTab === 'liked' }" @click="profileTab = 'liked'">Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª</button>
            </div>

            <div class="profile-content">
              <div v-if="profileTab === 'videos'" class="videos-grid">
                <div v-for="video in viewingProfile.videos" :key="video.id" class="video-thumb" @click="playVideo(video)">
                  <video :src="video.url"></video>
                </div>
              </div>
              <div v-if="profileTab === 'saved'" class="videos-grid">
                <div v-for="video in viewingProfile.saved" :key="video.id" class="video-thumb" @click="playVideo(video)">
                  <video :src="video.url"></video>
                </div>
              </div>
              <div v-if="profileTab === 'liked'" class="videos-grid">
                <div v-for="video in viewingProfile.liked" :key="video.id" class="video-thumb" @click="playVideo(video)">
                  <video :src="video.url"></video>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Modals -->

      <!-- Upload -->
      <div class="modal" v-if="showUpload" @click.self="showUpload = false">
        <div class="upload-modal">
          <h2>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</h2>
          <div class="upload-area" @click="$refs.videoInput.click()">
            <input type="file" ref="videoInput" accept="video/*" @change="handleVideoSelect" hidden>
            <video v-if="videoPreview" :src="videoPreview" controls></video>
            <div v-else class="placeholder">
              <i class="fas fa-cloud-upload-alt"></i>
              <p>Ø§Ø®ØªØ± ÙÙŠØ¯ÙŠÙˆ</p>
            </div>
          </div>
          <textarea v-model="uploadCaption" placeholder="ÙˆØµÙ..."></textarea>
          <button class="btn-primary" @click="uploadVideo" :disabled="!selectedVideo || uploading">
            {{ uploading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...' : 'Ù†Ø´Ø±' }}
          </button>
        </div>
      </div>

      <!-- Live -->
      <div class="live-modal" v-if="liveModal">
        <div class="live-prep" v-if="!isStreaming">
          <h2>ğŸ“¡ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø«</h2>
          <input type="text" v-model="liveTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø«">
          <div class="camera-preview">
            <video ref="previewVideo" autoplay muted v-show="cameraReady"></video>
            <button v-if="!cameraReady" @click="initCamera">ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
          </div>
          <button class="btn-live" @click="startLive" :disabled="!cameraReady">ğŸ”´ Ø§Ø¨Ø¯Ø£</button>
        </div>
        <div class="live-streaming" v-else>
          <video class="live-video" ref="liveVideo" autoplay muted></video>
          <div class="live-overlay">
            <div class="live-header">
              <span class="live-badge">ğŸ”´ LIVE</span>
              <span>{{ liveViewers }} Ù…Ø´Ø§Ù‡Ø¯</span>
              <button @click="endLive">Ø¥Ù†Ù‡Ø§Ø¡</button>
            </div>
            <div class="gifts-display">
              <div v-for="gift in recentGifts" :key="gift.id" class="gift-anim" :class="gift.animation">
                {{ gift.giftIcon }} {{ gift.sender }}
              </div>
            </div>
            <div class="comments">
              <div v-for="comment in liveComments" :key="comment.id">
                <img :src="comment.avatar">
                <span>{{ comment.username }}: {{ comment.text }}</span>
              </div>
            </div>
            <div class="controls">
              <input type="text" v-model="liveCommentText" @keyup.enter="sendLiveComment" placeholder="ØªØ¹Ù„ÙŠÙ‚...">
              <button @click="showGifts = true"><i class="fas fa-gift"></i></button>
              <button @click="sendLiveLike"><i class="fas fa-heart"></i></button>
            </div>
          </div>
        </div>
      </div>

      <!-- Gifts -->
      <div class="gifts-modal" v-if="showGifts" @click.self="showGifts = false">
        <div class="gifts-grid">
          <div v-for="gift in availableGifts" :key="gift.id" class="gift-item" @click="sendGift(gift)">
            <span class="icon">{{ gift.icon }}</span>
            <span class="name">{{ gift.name }}</span>
            <span class="price">${{ gift.price }}</span>
          </div>
        </div>
      </div>

      <!-- Stories Viewer -->
      <div class="stories-viewer" v-if="viewingStory" @click="closeStory">
        <div class="story-progress">
          <div class="bar" :style="{ width: storyProgress + '%' }"></div>
        </div>
        <img v-if="viewingStory.current.type === 'image'" :src="viewingStory.current.url">
        <video v-else :src="viewingStory.current.url" autoplay></video>
        <div class="story-info">
          <img :src="viewingStory.user.avatar">
          <span>@{{ viewingStory.user.username }}</span>
        </div>
      </div>

      <!-- Chat -->
      <div class="chat-modal" v-if="showChats">
        <div class="chat-list">
          <h3>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</h3>
          <div v-for="chat in chats" :key="chat.user.id" class="chat-item" @click="openChat(chat)">
            <img :src="chat.user.avatar">
            <div class="info">
              <h4>@{{ chat.user.username }}</h4>
              <p>{{ chat.lastMessage.text }}</p>
            </div>
            <span class="unread" v-if="chat.unread">{{ chat.unread }}</span>
          </div>
        </div>
      </div>

      <!-- Active Chat -->
      <div class="chat-window" v-if="activeChat">
        <div class="chat-header">
          <img :src="activeChat.user.avatar">
          <span>@{{ activeChat.user.username }}</span>
          <button @click="activeChat = null">Ã—</button>
        </div>
        <div class="messages">
          <div v-for="msg in chatMessages" :key="msg.id" :class="{ sent: msg.senderId === currentUser.id }">
            <p>{{ msg.text }}</p>
            <span>{{ formatTime(msg.createdAt) }}</span>
          </div>
        </div>
        <div class="input">
          <input type="text" v-model="chatInput" @keyup.enter="sendMessage" placeholder="Ø±Ø³Ø§Ù„Ø©...">
          <button @click="sendMessage"><i class="fas fa-paper-plane"></i></button>
        </div>
      </div>

      <!-- Notifications -->
      <div class="notifications-modal" v-if="showNotifications">
        <h3>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
        <div v-for="notif in notifications" :key="notif.id" class="notif-item" :class="{ unread: !notif.read }">
          <img :src="notif.fromAvatar || '/default-avatar.png'">
          <div class="content">
            <p v-if="notif.type === 'follow'"><strong>@{{ notif.fromUser }}</strong> ØªØ§Ø¨Ø¹Ùƒ</p>
            <p v-else-if="notif.type === 'like'"><strong>@{{ notif.fromUser }}</strong> Ø£Ø¹Ø¬Ø¨ Ø¨ÙÙŠØ¯ÙŠÙˆ</p>
            <p v-else-if="notif.type === 'gift'"><strong>@{{ notif.fromUser }}</strong> Ø£Ø±Ø³Ù„ {{ notif.giftIcon }}</p>
            <p v-else-if="notif.type === 'story'"><strong>@{{ notif.fromUser }}</strong> Ù†Ø´Ø± Ù‚ØµØ©</p>
          </div>
        </div>
      </div>
    </template>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="app.js"></script>
</body>
</html>
